# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
npm install helmet express-rate-limit joi xss winston express-validator
```

### 2. –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã

#### Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **`src/server/middleware/validation.js`** - –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è XSS
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–º–ø–∞–Ω–∏–π, —Ä–æ–ª–µ–π, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### –°–µ—Ä–≤–∏—Å –∞—É–¥–∏—Ç–∞
- **`src/server/services/auditService.js`** - –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª—ã
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤

#### –ú–∞—Ä—à—Ä—É—Ç –∞—É–¥–∏—Ç–∞
- **`src/server/routes/audit.js`** - API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∞—É–¥–∏—Ç–∞
  - GET `/api/audit` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤
  - GET `/api/audit/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **`migrations/versions/002_add_audit_log.js`** - –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞—É–¥–∏—Ç–∞
  - –¢–∞–±–ª–∏—Ü–∞ `audit_log` —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
  - –°–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã

#### –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **`src/server/app.js`** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
  - ‚úÖ **Security Headers** (helmet) - HSTS, CSP, X-Frame-Options, XSS Filter
  - ‚úÖ **Rate Limiting** - –æ–±—â–∏–π (100 req/15min) –∏ –¥–ª—è auth (5 req/15min)
  - ‚úÖ **CORS Security** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
  - ‚úÖ **XSS Protection** - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - ‚úÖ **Trust Proxy** - –¥–ª—è Railway

#### –ú–∞—Ä—à—Ä—É—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **`src/server/routes/auth.js`** - –£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
  - ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - —Å—Ö–µ–º–∞ –¥–ª—è –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è
  - ‚úÖ **–ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤
  - ‚úÖ **–ó–∞—â–∏—Ç–∞ logout** - —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### –ú–∞—Ä—à—Ä—É—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **`src/server/routes/users.js`** - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  - ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - —Å—Ç—Ä–æ–≥–∏–µ —Å—Ö–µ–º—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - ‚úÖ **–ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
  - ‚úÖ **–ó–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–π** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **`ENVIRONMENT_VARIABLES.md`** - –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
  - `ALLOWED_ORIGINS` - —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
  - `RATE_LIMIT_*` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ rate limiting

## üõ°Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1) ‚úÖ
1. **Security Headers** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS, clickjacking, MIME sniffing
2. **Rate Limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –∏ DDoS
3. **CORS Security** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º
4. **Input Validation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **XSS Protection** - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
6. **Audit Logging** - –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- **Trust Proxy** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∑–∞ –ø—Ä–æ–∫—Å–∏ (Railway)
- **Error Handling** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **Database Security** - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **JWT Security** - —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã: 4
- `src/server/middleware/validation.js` (85 —Å—Ç—Ä–æ–∫)
- `src/server/services/auditService.js` (120 —Å—Ç—Ä–æ–∫)
- `src/server/routes/audit.js` (35 —Å—Ç—Ä–æ–∫)
- `migrations/versions/002_add_audit_log.js` (50 —Å—Ç—Ä–æ–∫)

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: 4
- `src/server/app.js` (+60 —Å—Ç—Ä–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- `src/server/routes/auth.js` (+25 —Å—Ç—Ä–æ–∫ –∞—É–¥–∏—Ç–∞)
- `src/server/routes/users.js` (+20 —Å—Ç—Ä–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- `ENVIRONMENT_VARIABLES.md` (+10 —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)

### –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã: 5
- `helmet` - security headers
- `express-rate-limit` - rate limiting
- `joi` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `xss` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
- `winston` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `express-validator` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

## üîß –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –Ω–µ—Ç
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ** - –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ security headers** - —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ rate limiting** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏—Ç–∞** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Railway
```env
ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
AUTH_RATE_LIMIT_MAX_REQUESTS=5
```

### –ù–æ–≤—ã–µ API endpoints
- `GET /api/audit` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∞—É–¥–∏—Ç–∞ (—Ç–æ–ª—å–∫–æ admin)
- `GET /api/audit/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ admin)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `audit_log` –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –ª–æ–≥–∞–º

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ó–∞—â–∏—Ç–∞ –æ—Ç XSS** - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- **–ó–∞—â–∏—Ç–∞ –æ—Ç DDoS** - rate limiting –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ª–æ–≥–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - —Å–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
- **OWASP Top 10** - –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- **Security Headers** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Audit Trail** - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** üü¢ –ì–æ—Ç–æ–≤–æ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ø–ª–æ–π
